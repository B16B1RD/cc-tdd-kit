---
description: "15分マイクロTDDサイクル実行 - MVPファースト価値提供システム"
argument-hint: "[micro|空欄|他オプション]"
allowed-tools: ["Bash", "Read", "Write", "TodoWrite"]
---

# 15分マイクロTDD実行

モード: $ARGUMENTS（micro | 空欄 | 他オプション）

## 🚀 推奨: 15分マイクロサイクル

### メインモード: `micro` - MVPファースト価値提供 🎯
**15分で1つの体験価値を実現**し、即座にユーザーが体験可能な状態を作ります。

**モード選択**:
- `micro` または空欄: 15分マイクロサイクル（推奨）
- `legacy`: 90分イテレーション（非推奨）
- `--step`: 単一ステップのみ実行
- `--resume`: 中断箇所から再開

### 🎯 15分マイクロサイクルの流れ
```text
0-2分: 体験デザイン → 2-4分: RED → 4-10分: GREEN → 10-13分: REFACTOR → 13-15分: 体験確認
```

**目標**: 各サイクル終了時にユーザーが「おお！」と感じる状態

## ⚠️ 非推奨: 従来イテレーションモード

### `legacy` - 90分バッチ処理（Kent Beck原則に反する）
**非推奨理由**:
- 価値提供までの時間が長すぎる（90分待機）
- フィードバックループが遅い
- 技術基盤優先でユーザー体験後回し

**使用する場合**: 既存プロジェクトの大規模機能追加時のみ

## 🎯 指示: 15分マイクロTDDサイクル

**microモード**で以下を実行してください：

### 🚀 Phase 0: マイクロサイクル準備（0-2分）

#### 1. 体験価値の明確化
**今回の15分で実現する体験価値**を確認してください：

- `.claude/agile-artifacts/iterations/micro-iteration-*.md` から最新計画を読み込み
- **目標体験**: ユーザーが15分後に何を体験できるか
- **価値確認**: なぜその体験が嬉しいかを明確化

#### 2. 技術環境の簡易確認
**最小限の環境確認**ですぐに開発開始：

- テストコマンドの特定（`npm test`, `python -m pytest` 等）
- プロジェクトタイプの再確認（Web/CLI/API）
- **重要**: 技術セットアップは最小限に留める

#### 3. マイクロサイクル開始宣言
```text
🎯 15分マイクロサイクル開始！

🎯 目標体験: [今回実現する体験価値]
⏱️ 予定時間: 15分以内
🚀 期待結果: ユーザーが「[体験内容]」可能に

開始時刻: [timestamp]
```

### 🔄 Phase 1: REDフェーズ（2-4分）

#### 🔴テスト作成（最小限で1つ）

1. **体験ベースのテスト設計**を行ってください：
   - 技術的実装ではなく**ユーザー体験**をテスト
   - 「ユーザーがこれをできる」をテストする
   - 例: `test('ユーザーがボタンをクリックできる')` 

2. **1つのシンプルなテスト**を作成してください：
   ```javascript
   // 例: テトリスの場合
   test('ブロックが表示される', () => {
     expect(document.querySelector('#game-block')).toBeTruthy();
   });
   ```

3. **テスト実行で失敗確認**してください：
   ```bash
   pnpm test -- --watchAll=false --forceExit 2>&1
   # または
   python -m pytest -v 2>&1
   ```
   ⚠️ **必須**: テストが赤（失敗）であることを確認

### 🚀 Phase 2: GREENフェーズ（4-10分）

#### 🟢 Fake It戦略で最小実装

1. **最も恥ずかしいハードコーディング**で実装してください：
   ```javascript
   // 例: 最初は固定値でOK
   function createBlock() {
     return '<div id="game-block" style="width:20px;height:20px;background:red"></div>';
   }
   ```

2. **テストを緑にする**ことだけに集中してください：
   ```bash
   pnpm test -- --watchAll=false --forceExit 2>&1
   ```
   ✅ **目標**: テストが緑（成功）になる

3. **即座に動作確認**してください：
   - **Web**: ブラウザで結果を直接確認
   - **CLI**: コマンド実行で結果確認
   - **API**: curlでレスポンス確認

4. **品質チェック**を実行してください：
   ```bash
   pnpm lint 2>&1
   pnpm typecheck 2>&1  # TypeScriptの場合
   ```

5. **BEHAVIORコミット**で体験価値を記録してください：
   ```bash
   git add .
   git commit -m "[BEHAVIOR] [体験価値名]: Fake It implementation"
   ```

### 🔧 Phase 3: REFACTORフェーズ（10-13分）

#### 🔵 構造改善（必要に応じて）

1. **体験を壊さない範囲で構造改善**してください：
   - 変数名の改善
   - コードの整理と可読性向上
   - **重要**: 振る舞い（体験）は絶対に変更しない

2. **テストで体験保護を確認**してください：
   ```bash
   pnpm test -- --watchAll=false --forceExit 2>&1
   ```
   ✅ **目標**: テストが全て緑で振る舞い変化なし

3. **STRUCTUREコミット**で構造改善を記録してください：
   ```bash
   git add .
   git commit -m "[STRUCTURE] [体験価値名]: Code structure improvement"
   ```

### 🎉 Phase 4: 体験確認&完了（13-15分）

#### ✅ 最終体験確認

1. **ユーザー觖点で最終確認**してください：
   - 当初の目標体験が実現できているか？
   - ユーザーが「おお！」と感じるレベルか？
   - 次の15分で追加したい価値は何か？

2. **マイクロサイクル完了宣言**してください：
   ```text
   ✅ 15分マイクロサイクル完了！
   
   🎯 達成体験: [実現した体験価値]
   ⏱️ 実際時間: [timestamp - 開始時刻]
   🎉 ユーザー反応: [予想される反応]
   
   🚀 次の価値: [次に追加したい機能]
   ```

## 🚀 マイクロサイクル完了後の選択肢

**15分マイクロサイクル完了後**、以下から選択してください：

### ✅ 継続開発オプション

1. **🚀 次の15分サイクル** - さらなる価値追加
   ```bash
   /tdd:plan micro
   ```
   次の体験価値を計画して即座に継続

2. **📝 フィードバック収集** - ユーザーの声を聞く
   現在の体験についてフィードバックを収集

3. **🔍 体験テスト** - 他の人に見せる
   実際のユーザーに体験してもらい反応を確認

4. **📋 ストーリー見直し** - 計画を再検討
   当初のストーリーと実際の体験を比較して調整

5. **❤️ 休憩** - 満足したら終了
   現在の価値で十分なら休憩も大切

## ⚠️ Legacyモード: 90分イテレーション（非推奨）

**`legacy`モードの場合のみ**、以下の90分バッチ処理を実行：

### 1. プロジェクト分析と準備
- プロジェクトコンテキスト分析
- 最新イテレーションファイル読み込み
- 実行開始宣言

### 2. 従来TDDサイクル実行
- 長時間ステップの連続実行
- 各ステップでRED-GREEN-REFACTOR

### 3. 必須ゲート確認
- 動作確認（プロジェクトタイプ別）
- 受け入れ基準チェック
- 進捗同期

### 4. 従来完了処理

#### 単一ステップ完了時
次のステップの実行方法を案内

#### イテレーション完了時（legacyモードのみ）

### 🎯 成果物確認（legacyモード専用）

実装完了後、作成した成果物を以下の手順で確認してください：

#### 1. プロジェクトタイプ判定

以下を確認してプロジェクトタイプを判定してください：
- `package.json`の存在とscripts設定
- `requirements.txt`、`pyproject.toml`の存在
- `Cargo.toml`、`go.mod`の存在
- フレームワーク固有ファイル（`next.config.js`、`vite.config.js`等）

#### 2. タイプ別確認手順

判定されたプロジェクトタイプに応じて、以下から適切な確認方法を選択・実行してください：

**🌐 Webアプリ系**
- **React/Vue/Angular SPA**: 
  ```bash
  pnpm dev  # または npm run dev、bun dev
  ```
  ブラウザで `http://localhost:3000` を開いて動作確認

- **静的HTML**: 
  ```bash
  # 直接開く、または
  python3 -m http.server 8000
  ```
  ブラウザで `http://localhost:8000` または直接HTMLファイルを開く

- **Next.js/Nuxt.js**: 
  ```bash
  pnpm dev
  ```
  フル機能（SSR、API Routes等）の動作確認

**🖥️ CLI ツール系**
- **Node.js CLI**: 
  ```bash
  node dist/cli.js --help  # または pnpm cli --help
  ```
  ヘルプ表示と基本コマンド実行を確認

- **Python CLI**: 
  ```bash
  python main.py --help  # または python -m package --help
  ```
  コマンドライン引数処理と基本機能を確認

- **Go CLI**: 
  ```bash
  go run . --help  # またはビルドした実行ファイル
  ```
  バイナリ動作と基本機能を確認

**🔌 API サーバー系**
- **Express.js/Fastify**: 
  ```bash
  pnpm start  # または npm run server
  curl http://localhost:3000/api/health  # ヘルスチェック
  ```

- **FastAPI/Django**: 
  ```bash
  uvicorn main:app --reload  # または python manage.py runserver
  ```
  ブラウザで `http://localhost:8000/docs` （OpenAPI docs）を確認

- **Spring Boot**: 
  ```bash
  ./gradlew bootRun  # または mvn spring-boot:run
  curl http://localhost:8080/actuator/health
  ```

**📦 ライブラリ系**
- **npm package**: 
  ```bash
  pnpm build
  node -e "const lib = require('./dist'); console.log(lib)"
  ```
  ビルド成功とインポート可能性を確認

- **Python package**: 
  ```bash
  python -c "import package_name; print('Import successful')"
  ```
  インポート可能性と基本API動作を確認

- **Go module**: 
  ```bash
  go test ./...
  go mod tidy
  ```
  テスト実行とモジュール整合性を確認

**🖱️ デスクトップアプリ系**
- **Electron**: 
  ```bash
  pnpm electron  # または npm run electron
  ```
  アプリケーション起動と基本UI動作を確認

- **Tauri**: 
  ```bash
  cargo tauri dev  # または pnpm tauri dev
  ```
  ネイティブアプリケーション起動を確認

- **Java GUI**: 
  ```bash
  java -jar target/app.jar  # またはIDE実行
  ```
  GUI表示と基本操作を確認

**📊 データ分析系**
- **Jupyter Notebook**: 
  ```bash
  jupyter lab  # または jupyter notebook
  ```
  ノートブック実行と結果出力を確認

- **R Markdown**: 
  ```bash
  Rscript -e "rmarkdown::render('analysis.Rmd')"
  ```
  レポート生成と出力ファイルを確認

**📱 モバイル系**
- **React Native**: 
  ```bash
  pnpm start  # Metro bundler起動
  ```
  エミュレータまたは実機での動作確認

- **Flutter**: 
  ```bash
  flutter run
  ```
  エミュレータまたは実機での動作確認

#### 3. 確認完了チェック

以下を確認してください：
- ✅ 成果物が正常に動作する
- ✅ 実装した全機能が期待通りに動作する  
- ✅ ストーリーの受け入れ基準を全て満たしている
- ✅ エラーや警告が発生していない

### 📋 次のステップ選択

**成果物確認が完了した後**、以下から選択してください：

1. **イテレーション開始** 🚀 - 次のイテレーション自動計画
2. **フィードバック収集** 💭 - 詳細フィードバック収集
3. **機能追加** ➕ - 追加機能の分析と計画
4. **品質向上** 🔧 - コード品質向上
5. **プロジェクト完了** ✅ - プロジェクト終了

#### フィードバック入力時（選択肢2）
ユーザーに以下を質問してフィードバックを収集してください：
「成果物確認を含めた今回のイテレーションについて、ご感想や改善点があれば教えてください。」

フィードバック収集後、再度選択肢を表示してください。

## 🎯 15分マイクロサイクル原則

### MVPファースト原則
- **体験優先**: 技術的完璧さよりユーザー体験を最優先
- **15分ルール**: 15分以内に必ず体験価値を実現
- **即座フィードバック**: 各サイクル後に必ずユーザー確認
- **Fake It戦略**: 最初は恥ずかしいハードコーディングから

### Kent Beck TDD正式適用
- **"Make it work"** = 体験価値の実現（技術基盤ではない）
- **"Make it right"** = 構造改善（体験保護後）
- **"Make it fast"** = 最適化（最後の優先度）
- **Tidy First**: [BEHAVIOR]コミット → [STRUCTURE]コミット

### アジャイル原則
- **個人と対話**: 15分毎のユーザーフィードバック
- **動くソフトウェア**: 15分で動作する体験
- **顧客との協働**: ユーザー体験中心設計
- **変化への対応**: マイクロサイクルで柔軟性確保

## エラー対応 & トラブルシューティング

### マイクロサイクルでのエラー対応
1. **テストが緑にならない**:
   - Fake Itでもっとシンプルに
   - テスト自体が間違っている可能性を確認

2. **体験価値が感じられない**:
   - ユーザー觖点で再確認
   - 技術的完璧さより「おお！」を優先

3. **15分で終わらない**:
   - スコープが大きすぎる可能性
   - もっと小さな体験価値に分割

### レガシーモードエラー
- テスト環境の動作確認
- 依存関係のインストール状態
- TDD原則の遵守状態