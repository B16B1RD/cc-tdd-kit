# TDDキット最終コマンド構成設計書

## 🎯 統合決定の根拠

### イテレーション計画の必要性確認
✅ **Kent Beck XP 12プラクティス**の第1位「計画ゲーム」
✅ **短いイテレーション（1-3週間）**は XP の基本原則
✅ **15分マイクロイテレーション**は価値創造の最小単位
✅ **時間管理・価値判断**の実践的習得に必須

### 技術制約による統合必然性
❌ **現状**: `/tdd` から `/tdd:init`、`/tdd:story`、`/tdd:plan` を呼び出し（技術的に不可能）
✅ **解決**: すべてを `/tdd` に統合してワンコマンドで完結

## 📋 最終コマンド構成

### 🔄 統合コマンド（1個）

#### `/tdd` - Kent Beck純正TDD開発開始
**引数**: `"作りたいものの説明"`
**機能**: 要望→環境→ストーリー→イテレーション→実装案内の完全フロー
**統合内容**:
- 現在の `/tdd` 機能（要望分析・技術選択）
- 現在の `/tdd:init` 機能（環境初期化）
- 現在の `/tdd:story` 機能（ユーザーストーリー作成）
- 現在の `/tdd:plan` 機能（15分イテレーション計画）

### 🛠️ 独立コマンド（6個）

#### `/tdd:run` - TDD実行
**理由**: 実装フェーズは独立性が重要
**機能**: Red-Green-Refactorサイクル実行

#### `/tdd:status` - 進捗確認
**理由**: いつでも確認できる独立性が重要
**機能**: 価値実現度・TDD健全性分析

#### `/tdd:review` - 品質分析
**理由**: 定期的な品質確認の独立実行
**機能**: Kent Beck原則遵守度・改善推奨

#### `/tdd:feedback` - フィードバック収集
**理由**: 任意のタイミングでの実行が重要
**機能**: immediate/daily/weekly/retrospective

#### `/tdd:fix` - バグ修正
**理由**: 緊急対応時の独立実行が重要
**機能**: TDD原則に基づくバグ修正

#### `/tdd:detect` - 環境診断
**理由**: 問題発生時の独立診断が重要
**機能**: TDD環境の健全性チェック

### 🗑️ 削除対象コマンド（3個）

#### ❌ `/tdd:init` → `/tdd` に統合
**理由**: 環境初期化は開発開始の一部として自然

#### ❌ `/tdd:story` → `/tdd` に統合
**理由**: ストーリー作成は要望分析の延長として自然

#### ❌ `/tdd:plan` → `/tdd` に統合
**理由**: イテレーション計画はストーリー作成の直後に必要

### 📊 統合前後の比較

#### 統合前（10個のコマンド）
```
/tdd          # 要望受取・案内のみ
/tdd:init     # 環境初期化
/tdd:story    # ストーリー作成
/tdd:plan     # イテレーション計画
/tdd:run      # TDD実行
/tdd:status   # 進捗確認
/tdd:review   # 品質分析
/tdd:feedback # フィードバック
/tdd:fix      # バグ修正
/tdd:detect   # 環境診断
```

#### 統合後（7個のコマンド）
```
/tdd          # 完全な開発開始（4機能統合）
/tdd:run      # TDD実行
/tdd:status   # 進捗確認  
/tdd:review   # 品質分析
/tdd:feedback # フィードバック
/tdd:fix      # バグ修正
/tdd:detect   # 環境診断
```

## 🔄 統合後の `/tdd` 詳細フロー

### Phase 1: 要望分析・技術選択（2-3分）
```
入力: /tdd "シンプルな電卓Webアプリを作りたい"
↓
1. 要望の解析・理解
2. プロジェクトタイプ判定（web-app/cli-tool/api-server）
3. 技術スタック推奨（JavaScript + bun/pnpm）
4. 制約・前提条件の確認
```

### Phase 2: 環境初期化（1-2分）
```
統合元: /tdd:init の全機能
↓
1. ディレクトリ構造作成
   └── .claude/agile-artifacts/{stories,iterations,reviews,tdd-logs}
2. Git リポジトリ初期化
3. .gitignore 設定（個人ログ除外、チーム価値含む）
4. テスト環境確認（Jest/pytest等）
5. [INIT] 初期コミット
```

### Phase 3: ユーザーストーリー作成（3-5分）
```
統合元: /tdd:story の全機能
↓
1. INVEST基準分析
   - Independent: 独立性確認
   - Negotiable: 交渉可能性確認
   - Valuable: 価値明確化
   - Estimable: 見積もり可能性
   - Small: 適切なサイズ
   - Testable: テスト可能性
2. ユーザーストーリー記述
   - As a [ユーザータイプ]
   - I want [機能・行動]
   - So that [価値・理由]
3. 受け入れ基準定義
4. ストーリーファイル作成（.claude/agile-artifacts/stories/）
```

### Phase 4: 15分イテレーション計画（2-3分）
```
統合元: /tdd:plan の全機能
↓
1. 現在の動作状態確認
2. 次の15分で追加する価値定義
3. TDDサイクル設計
   - 分数 0-2: 体験デザイン
   - 分数 2-4: RED フェーズ
   - 分数 4-10: GREEN フェーズ
   - 分数 10-13: REFACTOR フェーズ
   - 分数 13-15: 価値確認・次計画
4. イテレーションファイル作成（.claude/agile-artifacts/iterations/）
```

### Phase 5: 実装開始案内（1分）
```
1. 実装推奨コマンド提示
   推奨: /tdd:run [最初の機能名]
   例: /tdd:run add-numbers

2. 継続開発の流れ説明
   - Red-Green-Refactor サイクル
   - Fake It戦略の重要性
   - BEHAVIOR/STRUCTUREコミット分離

3. フィードバックループ案内
   - /tdd:feedback immediate（即座確認）
   - /tdd:status（進捗確認）
   - /tdd:review（品質分析）
```

## ✅ 統合のメリット検証

### 1. ユーザーエクスペリエンス
- **最小学習コスト**: 覚えるコマンドが3個減少（10→7個）
- **迷いの排除**: 「どのコマンドから始めるか」の悩み解消
- **自然なフロー**: 人間の思考過程に沿った一連の流れ

### 2. 技術制約解決
- **コマンド間参照排除**: 技術的に不可能な問題の根本解決
- **エラー回避**: 存在しないコマンド呼び出しエラーなし
- **保守性向上**: 修正対象ファイル数削減（11→8ファイル）

### 3. Kent Beck/アジャイル原則準拠
- **価値の連続性**: 要望→価値定義→計画→実装の途切れない価値創造
- **無駄の排除**: 不要な分割による認知負荷・操作コスト削減
- **最小viable startup**: 最小限の手順で本格的TDD開発開始

### 4. 教育効果
- **段階的理解**: 1つのコマンドで全工程を体験
- **習慣化促進**: シンプルな開始方法による継続性向上
- **全体感把握**: TDD開発の完全な流れの理解

## 🎯 期待される成果

### 即座の効果
- **技術的実現可能性**: コマンド間参照問題の完全解決
- **開発開始の簡素化**: `/tdd "要望"` だけで完全準備完了
- **初心者の参入障壁削減**: 複雑なコマンド選択の排除

### 長期的効果
- **TDD文化の普及**: シンプルな開始方法による採用促進
- **Kent Beck原則の実践**: 正しいTDD手順の自然な習得
- **アジャイル価値の体現**: 継続的価値創造の文化定着

## 🛡️ リスク管理

### 潜在的リスク
1. **コマンド肥大化**: 1つのコマンドが複雑になりすぎる可能性
2. **柔軟性低下**: 部分的な実行ができない制約
3. **デバッグ困難**: 統合により問題箇所の特定が複雑化

### 対策
1. **明確な段階分離**: Phase 1-5の明確な区切りで可読性確保
2. **引数による部分実行**: 将来的な拡張で柔軟性追加可能
3. **詳細ログ出力**: 各段階の実行状況を明確に表示

## 💡 実装優先度

### 🔥 最高優先度（即座実装）
1. **`/tdd` 統合実装**: 4つの機能を1つに統合
2. **技術制約準拠確認**: コマンド間参照の完全排除
3. **基本動作テスト**: 統合後の動作確認

### 📋 高優先度（1週間以内）
1. **利用シナリオ更新**: 統合後のフローに合わせた更新
2. **エラーハンドリング**: 統合による新しいエラー状況への対応
3. **ドキュメント整備**: 新しいコマンド構成の説明

### 💡 中優先度（改善段階）
1. **部分実行機能**: 引数による柔軟性追加
2. **高度なメトリクス**: より詳細な分析機能
3. **IDE統合**: エディタプラグイン化

## 🚀 結論

**`/tdd:init`、`/tdd:story`、`/tdd:plan` の `/tdd` への統合**は、技術制約・ユーザビリティ・教育効果のすべての観点から**必須かつ最適**です。

この統合により、cc-tdd-kit は真に実用的で学習効果の高い**Kent Beck純正TDD実践ツール**として完成します。

**次のアクション**: 統合実装の開始を強く推奨します。